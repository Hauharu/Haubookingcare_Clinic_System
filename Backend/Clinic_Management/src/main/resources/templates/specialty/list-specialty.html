<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Danh sách chuyên khoa</title>
    <th:block th:replace="layout/base :: styles"></th:block>
</head>
<body>
    <div th:replace="layout/header :: header"></div>

    <div class="main-content">
        <div class="specialty-container">
            <h1 class="text-center mb-2 mt-4">Danh sách chuyên khoa</h1>

            <!-- Hiển thị thông báo thành công -->
            <div th:if="${successMessage}" class="alert alert-success container">
                <p th:text="${successMessage}"></p>
            </div>

            <!-- Hiển thị thông báo lỗi -->
            <div th:if="${errorMessage}" class="alert alert-danger container">
                <p th:text="${errorMessage}"></p>
            </div>

            <div class="container">
                <div class="table-container">
                    <div class="row mb-3">
                        <div class="col">
                            <a th:href="@{/specialty/create-specialty}" class="btn btn-primary">
                                <i class="fas fa-plus me-2"></i>Thêm chuyên khoa mới
                            </a>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-12">
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead class="table-dark">
                                        <tr>
                                            <th scope="col">STT</th>
                                            <th scope="col">Tên chuyên khoa</th>
                                            <th scope="col">Mô tả</th>
                                            <th scope="col">Số bác sĩ</th>
                                            <th scope="col">Thao tác</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr th:each="specialty, iterStat : ${specialties.content}">
                                            <th scope="row" th:text="${iterStat.index + 1 + (currentPage * specialties.size)}"></th>
                                            <td th:text="${specialty.name}"></td>
                                            <td th:text="${specialty.description ?: 'Chưa có mô tả'}"></td>
                                            <td>
                                                <span class="badge bg-info" th:text="${specialty.doctors?.size() ?: 0}"></span>
                                            </td>
                                            <td>
                                                <a th:href="@{/specialty/update-specialty/{id}(id=${specialty.id})}" class="btn btn-sm btn-warning me-1">
                                                    <i class="fas fa-edit"></i> Sửa
                                                </a>
                                                <button type="button"
                                                        class="btn btn-sm btn-danger"
                                                        th:data-specialty-id="${specialty.id}"
                                                        th:data-specialty-name="${specialty.name}"
                                                        data-bs-toggle="modal"
                                                        data-bs-target="#deleteModal">
                                                    <i class="fas fa-trash"></i> Xóa
                                                </button>
                                            </td>
                                        </tr>
                                        <tr th:if="${specialties.content.isEmpty()}">
                                            <td colspan="5" class="text-center text-muted py-4">
                                                <i class="fas fa-info-circle me-2"></i>
                                                Chưa có chuyên khoa nào
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Pagination -->
                    <div th:if="${specialties != null and totalPages > 1}" class="d-flex justify-content-center mt-3">
                        <nav aria-label="Specialty pagination">
                            <ul class="pagination">
                                <li class="page-item" th:class="${currentPage == 0} ? 'page-item disabled' : 'page-item'">
                                    <a class="page-link" th:href="@{/specialty(page=${currentPage - 1})}" th:unless="${currentPage == 0}">Trước</a>
                                    <span class="page-link" th:if="${currentPage == 0}">Trước</span>
                                </li>
                                <li class="page-item" th:each="pageNum : ${#numbers.sequence(0, totalPages - 1)}"
                                    th:class="${pageNum == currentPage} ? 'page-item active' : 'page-item'"
                                    th:if="${pageNum >= currentPage - 2 and pageNum <= currentPage + 2}">
                                    <a class="page-link" th:href="@{/specialty(page=${pageNum})}"
                                       th:text="${pageNum + 1}" th:unless="${pageNum == currentPage}"></a>
                                    <span class="page-link" th:if="${pageNum == currentPage}" th:text="${pageNum + 1}"></span>
                                </li>
                                <li class="page-item" th:class="${currentPage == totalPages - 1} ? 'page-item disabled' : 'page-item'">
                                    <a class="page-link" th:href="@{/specialty(page=${currentPage + 1})}" th:unless="${currentPage == totalPages - 1}">Sau</a>
                                    <span class="page-link" th:if="${currentPage == totalPages - 1}">Sau</span>
                                </li>
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal xác nhận xóa -->
    <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteModalLabel">Xác nhận xóa chuyên khoa</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Bạn có chắc chắn muốn xóa chuyên khoa <strong id="specialtyNameToDelete"></strong> không?</p>
                    <p class="text-warning">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        Lưu ý: Không thể xóa chuyên khoa đang có bác sĩ
                    </p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                    <form id="deleteForm" method="post" style="display: inline;">
                        <button type="submit" class="btn btn-danger">Xác nhận xóa</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div th:replace="layout/footer :: footer"></div>

    <script th:inline="javascript">
        // Xử lý modal xóa
        document.addEventListener('DOMContentLoaded', function() {
            const deleteModal = document.getElementById('deleteModal');
            const contextPath = /*[[@{/}]]*/ '/';

            deleteModal.addEventListener('show.bs.modal', function(event) {
                const button = event.relatedTarget;
                const specialtyId = button.getAttribute('data-specialty-id');
                const specialtyName = button.getAttribute('data-specialty-name');

                // Cập nhật tên chuyên khoa trong modal
                document.getElementById('specialtyNameToDelete').textContent = specialtyName;

                // Cập nhật action của form với context path
                document.getElementById('deleteForm').action = contextPath + 'specialty/delete-specialty/' + specialtyId;
            });
        });
    </script>
</body>
</html>
